Assignment 5 : Trigger
---
### Problem 1
Consider, the following relations:   
**RESULT(<u>ROLL, SCODE</u>, MARKS)**    
**BACKPAPER(ROLL, SCODE)**   
Write a trigger to do the following:  
Whenever a row is inserted or updated in `RESULT`, if the marks is 50 or more, delete the corresponding row, if any, from `BACKPAPER`. Otherwise insert a row in `BACKPAPER` if not already present there.

#### SQL Script
**Statement 1:** Creating RESULT table
```sql
create table RESULT (
    ROLL number not null,
    SCODE number not null,
    MARKS number not null
);

alter table RESULT add constraint result_pk primary key (ROLL, SCODE);
```
**Statement 2:** Creating BACKPAPER table
```sql
create table BACKPAPER (
    ROLL number not null,
    SCODE number not null
);
```

**Statement 3:** Creating the trigger
```sql
create or replace trigger AIUD_RESULT 
after insert or update on RESULT 
for each row 
begin 
    if inserting and :new.MARKS<50 then 
        insert into BACKPAPER ( SCODE,ROLL ) values ( :new.SCODE, :new.ROLL ); 
    end if;
    if updating then 
        if (:old.MARKS<50 and :new.MARKS>49) then
            delete from BACKPAPER where SCODE=:new.SCODE and ROLL=:new.ROLL;
        end if;
        if (:old.MARKS>49 and :new.MARKS<50) then
            insert into BACKPAPER ( SCODE,ROLL ) values ( :new.SCODE, :new.ROLL );     
        end if;
    end if; 
end;
```
---
### Problem 2
Consider, the following relations:  
**REQUEST(<u>REQ_NO</u>, REQ_DT)**    
**SERVICE_LOG(<u>ENTRY_NO</u>,REQ_NO, SERVICE_DT)**    
Write a trigger so that whenever rows are deleted from `REQUEST`, a log entry is made in `SERVICE_LOG.ENTRY_NO` has to be generated by incrementing the last value. `SERVICE_DT` will be the system date.

#### SQL Script
**Statement 1:** Creating REQUEST table
```sql
create table REQUEST ( 
    REQ_NO number not null constraint request_pk primary key, 
    REQ_DT date 
)
```
**Statement 2:** Creating SERVICE_LOG table
```sql
create table SERVICE_LOG ( 
    ENTRY_NO number constraint service_log_pk primary key, 
    REQ_NO number, 
    SERVICE_DT date
)
```
**Statement 3:** Creating AUTO INCREMENT for SERVICE_LOG table
```sql
create sequence service_log_seq
```
```sql
create or replace trigger BI_SERVICE_LOG_AUTO_INCREMENT 
before insert on SERVICE_LOG 
for each row 
begin 
    SELECT SERVICE_LOG_SEQ.nextval INTO :new.ENTRY_NO FROM dual; 
end;
```
**Statement 4:** Creating DELETE Trigger for SERVICE_LOG table
```sql
create or replace trigger AD_REQUEST 
after delete on REQUEST 
for each row 
begin 
    INSERT INTO SERVICE_LOG (SERVICE_DT, REQ_NO) VALUES (SYSDATE , :old.REQ_NO); 
end;
```